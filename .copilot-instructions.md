# Copilot Build Instructions for RasPin Pinball

## Build Methodology

**IMPORTANT**: For all Raspberry Pi builds, always use `run_in_terminal` with `isBackground=false` instead of `run_task`. This ensures compilation completes before analyzing output and prevents premature error checking.

## Raspberry Pi Build Commands

### Full Raspberry Pi Build
Use this command pattern for complete builds:

```bash
cd /home/jdbock/Dev/RasPin_Pinball && python src/update_version.py && /usr/bin/g++ -g -o raspibuild/Pinball src/stb_image.cpp src/PBOGLES.cpp src/PBGfx.cpp src/PBRaspPiRender.cpp src/PBDebounce.cpp src/Pinball_IO.cpp src/Pinball_Table.cpp src/PBSound.cpp src/PinballMenus.cpp src/PBSequences.cpp src/Pinball_Engine.cpp src/Pinball.cpp -I src/include_ogl_raspi -I/usr/include/EGL -I/usr/include/GLES3 -I/usr/include/KHR -I/usr/include/X11 -I/usr/include/X11/extensions -lEGL -lGLESv2 -lpthread -lm -lX11 -lXrandr -lwiringPi -lSDL2 -lSDL2_mixer
```

### Single File Test Compile
For testing individual files:

```bash
cd /home/jdbock/Dev/RasPin_Pinball && /usr/bin/g++ -c -g src/Pinball.cpp -I src/include_ogl_raspi -I/usr/include/EGL -I/usr/include/GLES3 -I/usr/include/KHR -I/usr/include/X11 -I/usr/include/X11/extensions -o /tmp/test.o
```

## Build Process Notes

1. **Always run version update first**: `python src/update_version.py`
2. **Check for new source files**: Before building, verify all `.cpp` files in `src/` are included
3. **Wait for compilation to complete** before analyzing output
4. **Use absolute paths** in all build commands
5. **Check for both compilation errors and warnings**

### Source File Verification

Before each build, check if new `.cpp` files have been added:

```bash
# List all .cpp files in src/ directory
find src/ -name "*.cpp" -type f | sort
```

**Current source files in build** (update this list when new files are added):
- src/stb_image.cpp
- src/PBOGLES.cpp
- src/PBGfx.cpp
- src/PBRaspPiRender.cpp
- src/PBDebounce.cpp
- src/Pinball_IO.cpp
- src/Pinball_Table.cpp
- src/PBSound.cpp
- src/PinballMenus.cpp
- src/PBSequences.cpp
- src/Pinball_Engine.cpp
- src/Pinball.cpp

**If new .cpp files are found:**
1. Add them to the build command after existing source files
2. Update this instruction file with the new file list
3. Test the build to ensure no linking errors

## Preferred Tool Usage

- ✅ **USE**: `run_in_terminal(command, explanation, isBackground=false)`
- ❌ **AVOID**: `run_task()` for builds (returns before completion)

## Error Handling

When build errors occur:
1. Wait for complete compilation output
2. Identify specific error lines and files
3. Fix errors before attempting another build
4. Re-run full build to verify fixes

## Project Structure

- **Source files**: `src/*.cpp` and `src/*.h`
- **Build output**: `raspibuild/Pinball`
- **Include paths**: `src/include_ogl_raspi/` and system includes
- **Libraries**: EGL, GLESv2, pthread, X11, wiringPi, SDL2

## Common Tasks

- **Clean build**: `rm -f raspibuild/Pinball` before building
- **Check errors**: Look for files with compilation issues
- **Version update**: Always included in build dependency chain
- **Verify source files**: `find src/ -name "*.cpp" -type f | sort`
- **Generate build command**: Use the following template to auto-generate:

### Auto-Generate Build Command

To automatically generate the build command with all current .cpp files:

```bash
# Generate source file list for build command
SOURCES=$(find src/ -name "*.cpp" -type f | sort | tr '\n' ' ')
echo "cd /home/jdbock/Dev/RasPin_Pinball && python src/update_version.py && /usr/bin/g++ -g -o raspibuild/Pinball $SOURCES -I src/include_ogl_raspi -I/usr/include/EGL -I/usr/include/GLES3 -I/usr/include/KHR -I/usr/include/X11 -I/usr/include/X11/extensions -lEGL -lGLESv2 -lpthread -lm -lX11 -lXrandr -lwiringPi -lSDL2 -lSDL2_mixer"
```

**When new .cpp files are added:**
1. Run the auto-generate command above
2. Use the generated command for builds
3. Update the "Full Raspberry Pi Build" section with the new command
4. Update the "Current source files in build" list above
